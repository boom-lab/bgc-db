{% extends 'partials/base.html' %}
{% block header %}
    <!-- boostrap select -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
    
    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
{% endblock header %}
{% block content %}
<div class="container-fluid">
    <select id="deployment_selector" class="selectpicker" data-live-search="true" multiple>
        <option value="1902303" selected>SN:1201 WMO:1902303</option>
        <option value="1902304">SN:1203 WMO:1902304</option>
    </select>
    <div id="map"></div>
</div>

{% endblock %}
{% block footer %}
<script> //Can move this to seperate js files as gets bigger
    //Updates div containing plot with a call to API
    function update_map(deployments){
        console.log(deployments)
            
        $.ajax({
            type: 'GET',
            url: "ajax/update_map",
            data: {"deployments[]": deployments},
            success: function (response) {
                //If sucessful, add plot
                console.log(response)
                $('#map').html(response["map_div"])
            },
            error: function (response) {
                console.log(response)
            }
        })
    }

    //Initial Load - maybe move to server side?
    update_map("1902303")

    //Change with deployment selection
    $("#deployment_selector").change(function (e) {
        e.preventDefault();
        //get selectors
        var profiles = $(this).val();
        //update plot
        update_map(profiles)
    })
</script>
{% endblock footer %}